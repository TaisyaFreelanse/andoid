services:
  # Backend Service (Fastify/Node.js)
  - type: web
    name: android-automation-backend
    env: node
    region: oregon  # или другой регион по вашему выбору
    plan: free  # или starter/standard/pro для продакшена
    rootDir: backend
    buildCommand: npm ci && npx prisma generate && npm run build
    startCommand: npm run migrate:start
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: HOST
        value: 0.0.0.0
      - key: DATABASE_URL
        fromDatabase:
          name: android-automation-db
          property: connectionString
      # Redis - настройте вручную после создания сервиса Redis (Upstash, Redis Cloud и т.д.)
      # Или используйте переменные окружения для внешнего Redis
      - key: REDIS_HOST
        sync: false  # Настроить вручную (например: redis-xxx.upstash.io)
      - key: REDIS_PORT
        sync: false  # Настроить вручную (обычно 6379 или 6380 для SSL)
      - key: REDIS_PASSWORD
        sync: false  # Настроить вручную
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_EXPIRES_IN
        value: 24h
      - key: REFRESH_TOKEN_SECRET
        generateValue: true
      - key: REFRESH_TOKEN_EXPIRES_IN
        value: 7d
      # MinIO/S3 - опционально, можно оставить пустым (файловое хранилище будет отключено)
      # Используйте внешний S3 (AWS S3, DigitalOcean Spaces, Backblaze B2 и т.д.)
      - key: MINIO_ENDPOINT
        sync: false  # Оставить пустым, если не используете S3
      - key: MINIO_PORT
        value: 443
      - key: MINIO_USE_SSL
        value: "true"
      - key: MINIO_ACCESS_KEY
        sync: false  # Оставить пустым, если не используете S3
      - key: MINIO_SECRET_KEY
        sync: false  # Оставить пустым, если не используете S3
      - key: MINIO_BUCKET_NAME
        value: screenshots
      - key: SEMRUSH_API_KEY
        sync: false  # Настроить вручную
      - key: CORS_ORIGIN
        fromService:
          name: android-automation-frontend
          type: web
          property: host
          format: https://${host}
      - key: LOG_LEVEL
        value: info

  # Frontend Service (React/Vite) - Static Site
  - type: web
    name: android-automation-frontend
    env: static
    rootDir: frontend
    buildCommand: npm ci && npm run build
    staticPublishPath: ./dist
    pullRequestPreviewsEnabled: true
    # Примечание: VITE_API_URL должен быть установлен вручную в Render Dashboard
    # так как переменные окружения для Static Site настраиваются отдельно
    # Установите: VITE_API_URL=https://android-automation-backend.onrender.com

  # MinIO Service (S3-compatible storage)
  # Примечание: MinIO требует Docker runtime и persistent disk
  # Создайте сервис вручную через Render Dashboard:
  # 1. New -> Web Service
  # 2. Connect ваш GitHub репозиторий
  # 3. Name: android-automation-minio
  # 4. Environment: Docker
  # 5. Dockerfile Path: ./minio/Dockerfile
  # 6. Root Directory: minio
  # 7. Plan: Starter (минимум для persistent disk)
  # 8. Environment Variables:
  #    - MINIO_ROOT_USER: (сгенерируйте или установите вручную)
  #    - MINIO_ROOT_PASSWORD: (сгенерируйте или установите вручную)
  # 9. После создания добавьте Persistent Disk в Settings -> Disks

databases:
  - name: android-automation-db
    plan: basic-256mb  # или basic-1gb/basic-4gb для продакшена
    databaseName: android_automation

