 Checklist для реализации системы автоматизации Android браузеров

Этот документ содержит чеклист всех компонентов, которые необходимо реализовать согласно архитектуре и плану разработки.

 Этап 2: Backend + Очередь + Минимальный UI

 2.1 Backend (Node.js/TypeScript + Fastify)

 Настройка проекта
- [ ] Инициализация Node.js проекта с TypeScript
- [ ] Настройка структуры папок согласно архитектуре
- [ ] Настройка ESLint и Prettier
- [ ] Настройка package.json с зависимостями
- [ ] Создание .env.example файла
- [ ] Настройка .gitignore

 База данных (PostgreSQL + Prisma)
- [ ] Установка и настройка Prisma
- [ ] Создание schema.prisma с моделями:
  - [ ] User
  - [ ] Device
  - [ ] Task
  - [ ] TaskStep
  - [ ] Proxy
  - [ ] ParsedData
  - [ ] AhrefsData
  - [ ] DeviceFingerprint
  - [ ] AuditLog
- [ ] Создание миграций Prisma
- [ ] Настройка подключения к PostgreSQL
- [ ] Создание seed данных (опционально)

 API Routes
- [ ] `/api/auth/login` - аутентификация
- [ ] `/api/auth/refresh` - обновление токена
- [ ] `/api/devices` - CRUD для устройств
- [ ] `/api/devices/:id/status` - статус устройства
- [ ] `/api/tasks` - CRUD для задач
- [ ] `/api/tasks/:id/results` - результаты задачи
- [ ] `/api/proxies` - CRUD для прокси
- [ ] `/api/parsed-data` - список спарсенных данных
- [ ] `/api/parsed-data/export` - экспорт CSV/JSON
- [ ] `/api/artifacts/:id` - получение скриншота

 Agent API Routes
- [ ] `/api/agent/register` - регистрация агента
- [ ] `/api/agent/heartbeat` - heartbeat
- [ ] `/api/agent/tasks` - получение задач
- [ ] `/api/agent/tasks/:id/result` - отправка результата
- [ ] `/api/agent/screenshot` - загрузка скриншота

 Services
- [ ] `device.service.ts` - бизнес-логика устройств
- [ ] `task.service.ts` - бизнес-логика задач
- [ ] `proxy.service.ts` - управление прокси
- [ ] `ahrefs.service.ts` - интеграция с Ahrefs API
- [ ] `storage.service.ts` - работа с MinIO/S3
- [ ] `auth.service.ts` - аутентификация и JWT
- [ ] `audit.service.ts` - логирование действий

 Middleware
- [ ] `auth.middleware.ts` - проверка JWT токена
- [ ] `rbac.middleware.ts` - проверка прав доступа
- [ ] `rate-limit.middleware.ts` - ограничение запросов
- [ ] `validation.middleware.ts` - валидация входных данных
- [ ] `error-handler.middleware.ts` - обработка ошибок

 Очередь задач (Redis + Bull)
- [ ] Настройка подключения к Redis
- [ ] Создание очереди Bull для задач
- [ ] `task.processor.ts` - обработчик задач
- [ ] Настройка retry механизма
- [ ] Настройка приоритетов задач
- [ ] Интеграция Bull Board для мониторинга

 Интеграции
- [ ] Интеграция с Ahrefs API
  - [ ] Метод проверки домена
  - [ ] Кеширование результатов (24 часа)
  - [ ] Обработка rate limits
  - [ ] Обработка ошибок API
- [ ] Интеграция с MinIO/S3
  - [ ] Загрузка файлов
  - [ ] Генерация presigned URLs
  - [ ] Удаление старых файлов

Безопасность
- [ ] Реализация JWT токенов (access + refresh)
- [ ] Шифрование прокси credentials в БД
- [ ] Реализация RBAC (admin, operator, viewer)
- [ ] Audit логирование всех действий
- [ ] Rate limiting для всех endpoints
- [ ] Валидация всех входных данных
- [ ] Защита от SQL injection (через Prisma)
- [ ] Защита от XSS

 Утилиты
- [ ] `logger.ts` - структурированное логирование
- [ ] `validator.ts` - валидация данных
- [ ] `encryption.ts` - шифрование/дешифрование
- [ ] `date-utils.ts` - работа с датами

 2.2 Web UI (React + TypeScript + Vite)

 Настройка проекта
- [ ] Инициализация React проекта с Vite
- [ ] Настройка TypeScript
- [ ] Настройка структуры папок
- [ ] Настройка роутинга (React Router)
- [ ] Настройка HTTP клиента (axios/fetch)

 Страницы
- [ ] `/login` - страница авторизации
- [ ] `/devices` - список устройств
- [ ] `/tasks` - список задач
- [ ] `/tasks/:id` - детали задачи
- [ ] `/logs` - просмотр логов (WebSocket)
- [ ] `/artifacts` - просмотр скриншотов

 Компоненты
- [ ] `DeviceList` - список устройств с фильтрацией
- [ ] `DeviceCard` - карточка устройства
- [ ] `TaskList` - список задач
- [ ] `TaskCard` - карточка задачи
- [ ] `TaskForm` - форма создания задачи
- [ ] `LogViewer` - просмотр логов в реальном времени
- [ ] `ScreenshotViewer` - просмотр скриншотов
- [ ] `DataExport` - экспорт данных
- [ ] `Navigation` - навигационное меню
- [ ] `AuthGuard` - защита маршрутов

 Функциональность
- [ ] Аутентификация (login/logout)
- [ ] Отображение статуса устройств в реальном времени
- [ ] Создание и управление задачами
- [ ] Просмотр результатов парсинга
- [ ] Экспорт данных (CSV/JSON)
- [ ] Просмотр скриншотов
- [ ] WebSocket подключение для real-time обновлений

 2.3 Docker Compose

 Сервисы
- [ ] `backend` - Node.js приложение
- [ ] `postgres` - PostgreSQL база данных
- [ ] `redis` - Redis для очереди
- [ ] `minio` - MinIO для хранения файлов
- [ ] `nginx` - reverse proxy (опционально)

 Конфигурация
- [ ] docker-compose.yml файл
- [ ] Dockerfile для backend
- [ ] Dockerfile для frontend (опционально)
- [ ] Настройка переменных окружения
- [ ] Настройка volumes для данных
- [ ] Настройка сетей между сервисами

 Документация
- [ ] Инструкция по запуску через Docker Compose
- [ ] Описание переменных окружения
- [ ] Инструкция по настройке для продакшена

 Этап 3: Android Agent (APK)
 3.1 Настройка проекта

 Android Studio проект
- [ ] Создание нового Android проекта (Kotlin)
- [ ] Настройка минимальной версии SDK (API 24)
- [ ] Настройка структуры папок
- [ ] Настройка зависимостей (Gradle)

 Разрешения
- [ ] INTERNET - доступ к интернету
- [ ] ACCESS_NETWORK_STATE - проверка сети
- [ ] WRITE_EXTERNAL_STORAGE - сохранение файлов
- [ ] READ_EXTERNAL_STORAGE - чтение файлов
- [ ] FOREGROUND_SERVICE - фоновый сервис

 3.2 Основные компоненты

 Services
- [ ] `ControllerService.kt` - фоновый сервис
  - [ ] Регистрация устройства
  - [ ] Heartbeat каждые 30 секунд
  - [ ] Получение задач
  - [ ] Управление жизненным циклом
- [ ] `TaskExecutor.kt` - выполнение задач
  - [ ] Парсинг конфигурации задачи
  - [ ] Выполнение шагов (navigate, wait, click, extract, screenshot)
  - [ ] Обработка ошибок
  - [ ] Отправка результатов
- [ ] `UniquenessService.kt` - уникализация устройства
  - [ ] Регенерация Android ID
  - [ ] Регенерация AAID
  - [ ] Очистка Chrome/WebView data
  - [ ] Изменение User-Agent
  - [ ] Изменение timezone
  - [ ] Изменение build.prop

 Browser
- [ ] `BrowserSelector.kt` - выбор браузера
- [ ] `ChromeController.kt` - управление Chrome
  - [ ] Открытие Chrome через Intent
  - [ ] Управление через Accessibility API
  - [ ] DevTools Remote Debugging (опционально)
- [ ] `WebViewController.kt` - встроенный WebView
  - [ ] Настройка WebView
  - [ ] Навигация
  - [ ] JavaScript injection
  - [ ] Парсинг DOM

 Automation
- [ ] `Navigator.kt` - навигация
  - [ ] navigate(url)
  - [ ] wait(duration)
  - [ ] click(selector)
  - [ ] scroll(direction, pixels)
- [ ] `Parser.kt` - парсинг данных
  - [ ] extract(selector, attribute) - CSS/XPath
  - [ ] extractAdUrl(url) - извлечение adurl
  - [ ] extractDomain(url) - извлечение домена
- [ ] `Screenshot.kt` - создание скриншотов
  - [ ] Полный скриншот страницы
  - [ ] Скриншот элемента по селектору

 Network
- [ ] `ProxyManager.kt` - управление прокси
  - [ ] Настройка прокси для HTTP запросов
  - [ ] Настройка прокси для WebView
  - [ ] Проверка работоспособности прокси
- [ ] `ApiClient.kt` - HTTP клиент
  - [ ] Регистрация устройства
  - [ ] Heartbeat
  - [ ] Получение задач
  - [ ] Отправка результатов
  - [ ] Загрузка скриншотов

 Utils
- [ ] `RootUtils.kt` - работа с root
  - [ ] Проверка root прав
  - [ ] Выполнение root команд
  - [ ] Валидация команд (whitelist)
- [ ] `DeviceInfo.kt` - информация об устройстве
  - [ ] Получение Android ID
  - [ ] Получение AAID
  - [ ] Получение IP адреса
  - [ ] Получение User-Agent

 3.3 UI (минимальный)

- [ ] `MainActivity.kt` - главная активность
- [ ] Отображение статуса подключения
- [ ] Отображение текущей задачи
- [ ] Кнопка запуска/остановки сервиса
- [ ] Настройки (URL контроллера, токен)

 3.4 Сборка и подпись

- [ ] Настройка signing config
- [ ] Сборка release APK
- [ ] Подпись APK
- [ ] Тестирование установки на устройство

 Этап 4: Хранение и экспорт

 4.1 MinIO/S3 интеграция

- [ ] Настройка подключения к MinIO
- [ ] Загрузка скриншотов
- [ ] Организация файлов по папкам
- [ ] Генерация presigned URLs
- [ ] Удаление старых файлов (автоматическая очистка)

 4.2 Экспорт данных

- [ ] Экспорт в CSV формат
- [ ] Экспорт в JSON формат
- [ ] Фильтрация данных при экспорте
- [ ] Пагинация для больших объемов
- [ ] Скачивание файла экспорта

 4.3 API выгрузки

- [ ] RESTful API для получения данных
- [ ] Фильтрация по дате, устройству, задаче
- [ ] Пагинация результатов
- [ ] Сортировка результатов

 Этап 5: Интеграция и тестирование

 5.1 Интеграционные тесты

 Тесты на 3-5 устройствах
- [ ] Регистрация устройств
- [ ] Создание и выполнение задач
- [ ] Парсинг рекламных баннеров
- [ ] Проверка Ahrefs API
- [ ] Уникализация устройств
- [ ] Загрузка скриншотов

 Smoke tests на 20 устройствах
- [ ] Одновременная регистрация всех устройств
- [ ] Параллельное выполнение задач
- [ ] Проверка стабильности heartbeat
- [ ] Нагрузочное тестирование backend

 5.2 Баг-фиксинг

- [ ] Исправление найденных багов
- [ ] Оптимизация производительности
- [ ] Улучшение обработки ошибок
- [ ] Улучшение логирования

 5.3 Документация

- [ ] `DEPLOYMENT.md` - инструкция по развертыванию
- [ ] `API.md` - описание API endpoints
- [ ] `AGENT_SETUP.md` - установка и настройка агента
- [ ] `SCENARIOS.md` - примеры сценариев
- [ ] `TROUBLESHOOTING.md` - решение проблем

 5.4 Checklist приёмки

- [ ] Все устройства регистрируются и отправляют heartbeat
- [ ] Задачи выполняются корректно на всех устройствах
- [ ] Парсинг adurl работает на всех тестовых сайтах
- [ ] Скриншоты сохраняются и доступны через UI
- [ ] Ahrefs API интегрирован и данные сохраняются
- [ ] Уникализация устройств работает
- [ ] Экспорт CSV/JSON работает
- [ ] UI отображает все данные корректно
- [ ] Система работает стабильно с 20 устройствами параллельно
- [ ] Удаленное управление через RDP работает

 Общие требования

 Код качество
- [ ] Code review для всех изменений
- [ ] Unit тесты для критичных компонентов
- [ ] Интеграционные тесты
- [ ] Документация кода (JSDoc/KDoc)
- [ ] Следование code style guidelines

 Безопасность
- [ ] Все секреты в .env (не коммитить)
- [ ] HTTPS для всех соединений
- [ ] Валидация всех входных данных
- [ ] Защита от SQL injection
- [ ] Защита от XSS
- [ ] Rate limiting
- [ ] Audit логирование

 Производительность
- [ ] Оптимизация запросов к БД (индексы)
- [ ] Кеширование где возможно
- [ ] Оптимизация размера APK
- [ ] Оптимизация загрузки файлов

 Мониторинг
- [ ] Логирование всех ошибок
- [ ] Метрики производительности
- [ ] Health check endpoints
- [ ] Мониторинг очереди задач





